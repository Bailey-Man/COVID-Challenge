<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID Data Challenge</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header id="header">
        <h1>COVID Data Challenge</h1>
    </header>

    <main id="main">

        <section id="top">
            <div id="input">
                <h2>Input Header</h2>
                <form>
                    <!--Zip-->
                    <label for="source-zip">Source zip code:</label>
                    <input type="text" id="source-zip" name="source-zip" value="" onchange="enable_type(this.value)"><br>

                    <!--Types at Source Zip-->
                    <label for="type-dropdown">Select a Type:</label><br>
                    <select id="type-dropdown" disabled="disabled" onchange="enable_POI()">
                        <option>Type</option>
                    </select><br>

                    <!--POIs at Source Zip & Type-->
                    <label for="POI-dropdown">Select a Point of Interest:</label><br>
                    <select id="POI-dropdown" disabled="disabled">
                        <option>POI</option>
                    </select><br>

                    <!--Submit Button-->
                    <br><input type="button" value="Go" onclick="evaluate_input()" /><br>
                    <div id="alert" style="color: red"></div>
                </form>


            </div>

            <div id="map">
            </div>
        </section>

        <section id="bottom">
            <div id="disclaimer">
                <h2>Disclaimer Header</h2>
                <ul>
                    <li>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                    </li>
                    <li>
                        <p>Etiam commodo eros at imperdiet commodo. Aenean egestas aliquam metus, ac laoreet lectus rutrum vehicula. Aliquam erat volutpat.</p>
                    </li>
                    <li>
                        <p>Vestibulum ac velit leo. Aliquam tincidunt sapien lorem, accumsan congue metus lobortis quis.</p>
                    </li>
                    <li>
                        <p>Duis porttitor urna sed orci luctus molestie. Mauris euismod sodales venenatis. Aenean eleifend at velit vitae suscipit. Nullam laoreet efficitur ligula vitae congue. Praesent at augue ligula.</p>
                    </li>
                </ul>
            </div>
            <div id="output">
                <h2>Output Header</h2>
                <p>
                    The Source Zip Code will be displayed here: <span id="src-zip-out"></span>
                </p>
                <p>
                    The POIs will be displayed here: <span id="POI-out"></span>
                    <table id="myTable"></table>
                </p>
            </div>
        </section>
    </main>

    <footer>
        This is the footer
        <ul>Data Sets Used</ul>
        <li>
            <a href="Final_POI_risk_9_23_2020.csv">Dataset 1</a>
        </li>
        <li>
            Dataset 2
        </li>
    </footer>


    <!--Google Maps-->

    <!-----------------------------------------------------------------------------------------------------------------------
    <script>
        // Initialize and add the map
        function initMap() {
            // The location of Uluru
            var uluru = {
                lat: 33.0,
                lng: -116.86
            };
            // The map, centered at Uluru
            var map = new google.maps.Map(
                document.getElementById('map'), {
                    zoom: 9,
                    center: uluru
                });
            // The marker, positioned at Uluru

        }
        /*Load the API from the specified URL
         The async attribute allows the browser to render the page while the API loads
         The key parameter will contain your own API key (which is not needed for this tutorial)
         The callback parameter executes the initMap() function
        */
    </script>
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8zfDkpEDIgL0UhUvYvwu-J1JCPvriRIk&callback=initMap">
    </script>
    ------------------------------------------------------------------------------------------------------------------------>

</body>

<script src="papaparse.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>


<script>
    evaluate_input();

    function evaluate_input() {
        /*******************************************************/
        /*Begin evaluating                                     */


    }

    /**********************OnCLICK Events*************************/
    function is_zip_valid(data) {
        var usr_zip = (document.getElementById("source-zip").value);
        var csv_zip;
        var zip_arr = new Array();
        for (var i = 0; i < data.length; i++) {

        }
    }

    function enable_type(value) {
        if (parseData(is_zip_valid));

        document.getElementById("type-dropdown").disabled = false;
        parseData(getTypes);
    }

    function enable_POI() {
        document.getElementById("POI-dropdown").disabled = false;
        parseData(getPOIs);
    }

    /**********************OnCLICK Events*************************/

    function has_input(ID_array) {
        var input;
        for (var i = 0; i < ID_array.length; i++) {
            input = document.getElementById(ID_array[i]);
            if (input && input.value) {
                continue;
            }
            return false
        }
        return true;
    }

    function tester() {}

    function calculate_risk_comparison() {

    }

    function modify_output_section() {}

    function assign_types() {}

    function append_dropdown(elementID, optionsArr) {
        var select = document.getElementById(elementID)
        for (var i = 0; i < optionsArr.length; i++) {
            var opt = (optionsArr[i]);
            var el = document.createElement("option");
            el.textContent = opt;
            el.value = opt;
            select.appendChild(el);
        }
    }

    function append_dropdown_object(elementID, optionsArr) {
        var select = document.getElementById(elementID)
        for (var i = 0; i < optionsArr.length; i++) {
            var opt = (optionsArr[i].name);
            var el = document.createElement("option");
            el.textContent = opt;
            el.value = opt;
            select.appendChild(el);
        }
    }


    function isUnique(item, arr) {
        for (var i = 0; i < arr.length; i++) {
            if (item == (arr[i])) {
                return false;
            }
        }
        return true;
    }

    function isUnique_object(item, arr) {
        for (var i = 0; i < arr.length; i++) {
            if (item == (arr[i].name)) {
                return false;
            }
        }
        return true;
    }

    function getTypes(data) {
        var usr_zip = document.getElementById('source-zip').value;
        var csv_zip;
        var csv_type;
        var row = [];
        var type_arr = new Array();
        var count = 0;
        for (var i = 0; i < data.length; i++) {

            row = Object.values(data[i]); //get the ith row
            csv_type = row[19]; // the type of a POI
            csv_zip = row[3]; // the zip where a POI is located

            if (isUnique_object(csv_type, type_arr) && csv_zip == usr_zip) { // if the value is unique, add it to the array
                var type_object = {
                    name: csv_type, // Create a type object that holds the name of the type and
                    type_count: 1 // how many times that type displays in the data
                };
                type_arr.push(type_object);
            }
        }
        type_arr.sort((a, b) => (a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0));
        append_dropdown_object("type-dropdown", type_arr);
    }

    function getPOIs(data) {
        //user input
        var usr_zip = document.getElementById('source-zip').value;
        var usr_type = document.getElementById('type-dropdown').value;

        //csv values
        var csv_zip;
        var csv_type;
        var csv_POI;
        var csv_risk;
        var csv_address;

        //csv row
        var row = [];
        var POI_arr = new Array();
        var test_arr = new Array();

        var count = 0;
        for (var i = 0; i < data.length; i++) {
            row = Object.values(data[i]); //get the ith row
            csv_zip = row[3];
            csv_type = row[19];
            csv_POI = row[1];
            csv_risk = row[20];
            csv_address = row[17];
            if ((csv_zip == usr_zip) && (csv_type == usr_type))
                if (isUnique(csv_POI, POI_arr)) {
                    POI_arr.push(csv_POI);
                    var POI_object = {
                        name: csv_POI,
                        risk: csv_risk,

                    };
                    test_arr.push(POI_object);

                } else { //not unique
                    /*var POI_object = {
                        name: csv_POI + " (" + csv_address + ")",
                        risk: csv_risk,
                    };
                    POI_arr.push*/
                }

        }
        //console.log(POI_arr);
        POI_arr.sort();
        //append_dropdown("POI-dropdown", POI_arr);
        test_arr.sort((a, b) => (a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0));
        console.log(test_arr);
        append_dropdown_object("POI-dropdown", test_arr);

    }

    function parseData(callback) {
        Papa.parse("https://marykovic.github.io/COVID-Challenge/Final_POI_risk_9_23_2020.csv", {
            download: true,
            header: true,
            //preview: 100,
            complete: function(results) {
                callback(results.data);
            }
        });
    }
</script>
<script>
</script>

</html>
